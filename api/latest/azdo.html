<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OGRE-Next: AZDO changes (Aproaching Zero Driver Overhead)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="ogre_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="ogre-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">OGRE-Next<span id="projectnumber">&#160;4.0.0unstable</span>
   </div>
   <div id="projectbrief">Object-Oriented Graphics Rendering Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('azdo.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">AZDO changes (Aproaching Zero Driver Overhead)</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#V2AndV1Objects">V2 and v1 objects</a><ul><li class="level2"><a href="#V2AndV1ObjectsV1Longevity">Longevity of the v1 objects and deprecation</a></li>
</ul>
</li>
<li class="level1"><a href="#RenderQueue">Render Queue</a></li>
<li class="level1"><a href="#VaoMaanger">The VaoManager</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="V2AndV1Objects"></a>
V2 and v1 objects</h1>
<p>Because of the big overhaul that <a class="el" href="namespace_ogre.html" title="bswapNN may be defined as macros in &lt;sys/endian.h&gt; or &lt;sys/bswap.h&gt;">Ogre</a> 2.0 Final went through, there were a lot of optimizations that were just incompatible with how the old code worked. On the other hand, removing the old code was unwise as there are a lot of features that haven't been ported to v2 interfaces yet.</p>
<p>The solution was to build a parallel system that runs alongside the old one; enclosing the old ones in the v1 namespace.</p>
<p>As a result, <code>Entity</code> got replaced by <code>Item</code>; and thus now to access them, you need to write <code>v1::Entity</code> and Item.</p>
<p>Some objects may have the same name but live in a different namespace and thus are not the same: <code>v1::Mesh</code> (defined in <a class="el" href="_ogre_mesh_8h.html">OgreMesh.h</a>) and <code>Mesh</code> (defined in <a class="el" href="_ogre_mesh2_8h.html">OgreMesh2.h</a>)</p>
<h2><a class="anchor" id="V2AndV1ObjectsV1Longevity"></a>
Longevity of the v1 objects and deprecation</h2>
<p>The initial plan was to remove all v1 functionality once they have their v2 counterpart.</p>
<p>However after evaluating community feedback and the tech involved; this isn't always the case as there is v1 functionality that will not be ported to v2 but is critical to several commercial business relying on OGRE. The following functionality that lives in the v1 namespace will remain to be supported:</p>
<ul>
<li>Software Skinning: SW Skinning will not be ported to v2 because supporting it brings down overall efficiency and adds a disproportionate amount of complexity. However, this feature is relevant for applications wanting to skeletally animate models in a deterministic way regardless of the hardware and drivers it's running on, and read back the results from CPU very quickly. Therefore we will continue to support <code>v1::Entity</code> and <code>v1::Skeleton</code>.</li>
<li>Software Pose/Morph animations: The reasons are exactly the same as SW Skinning.</li>
<li><code>v1::Skeleton</code>: The new v2 Skeletal animation system was written for animating large crowds with high performance; and replace the old system. However, after experimenting with the new system, while it is clear that it runs significantly faster; it became apparent that it is very difficult and inefficient to alter the bone hierarchy and its animations once it has been built and baked. In other words, v1 skeleton is very flexible for realtime editing, while v2 skeleton is very fast for playback. For this reason, we will continue to support v1 skeletons for a very long time. It is also possible to easily import v1 skeletons into v2 skeletons; which is very convenient for animation tools who may want the best performance once they switch to their "playback mode" (i.e. final rendering started) after the modeler finished editing the skeleton.</li>
</ul>
<h1><a class="anchor" id="RenderQueue"></a>
Render Queue</h1>
<p>The RenderQueue has been completely refactored. It sorts based on a 64-bit hash which is calculated in <code>RenderQueue::addRenderable</code>. Mesh ID, material ID, texture hash, depth, macro and blend block IDs are taken into account[^13].</p>
<p>Each RenderQueue ID can run in any of the following modes of operation:</p>
<ol type="1">
<li><code>V1_LEGACY</code>: It runs as closely as possible as <a class="el" href="namespace_ogre.html" title="bswapNN may be defined as macros in &lt;sys/endian.h&gt; or &lt;sys/bswap.h&gt;">Ogre</a> 1.x ran. Only low level materials can work in this mode; and only v1 objects can be stored in RenderQueue IDs operating in this mode This mode of operation is not recommended for a large number of objects.</li>
<li><code>V1_FAST</code>: Certain obscures features from <a class="el" href="namespace_ogre.html" title="bswapNN may be defined as macros in &lt;sys/endian.h&gt; or &lt;sys/bswap.h&gt;">Ogre</a> 1.x won't be available (i.e. the HW GlobalInstance buffer). The RenderQueue will first iterate through all objects, auto-instancing when possible; and updating the shader's constant and texture buffers; then using the Command Buffer all necessary state changes and draw calls. Only v1 objects can live in these RenderQueue Ids. Originally they could only use Hlms materials, but support for Low Level materials was later was added. Note that low level materials cannot be auto instanced.</li>
<li><code>FAST</code>: The new system. It's similar to <code>V1_FAST</code>. However, only v2 objects can be used. The API overhead is extremely low; and is more multicore-friendly because <code>RenderQueue::addRenderable</code> is executed in parallel.</li>
</ol>
<p>You cannot mix v1 and v2 objects in the same RQ ID, however you can store them in different RQ IDs.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">RQ Mode   </th><th class="markdownTableHeadNone">Object type   </th><th class="markdownTableHeadNone">Hlms materials   </th><th class="markdownTableHeadNone">Low Level materials    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">V1_LEGACY   </td><td class="markdownTableBodyNone">v1   </td><td class="markdownTableBodyNone">NO   </td><td class="markdownTableBodyNone">YES    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">V1_FAST   </td><td class="markdownTableBodyNone">v1   </td><td class="markdownTableBodyNone">YES   </td><td class="markdownTableBodyNone">YES    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">FAST   </td><td class="markdownTableBodyNone">v2   </td><td class="markdownTableBodyNone">YES   </td><td class="markdownTableBodyNone">YES   </td></tr>
</table>
<p>It is not automatic. Placing a v2 object in a v1 queue or viceversa may result in <a class="el" href="namespace_ogre.html" title="bswapNN may be defined as macros in &lt;sys/endian.h&gt; or &lt;sys/bswap.h&gt;">Ogre</a> raising a helpful exception, or an unhelpful crash (it is hard to track all sources of RQ missmatches); however with a debugger hooked, it can be easy to spot the problem by looking at the routine names (e.g. look at the v2/v1 suffixes) and the mVaoPerLod member being non empty (which indicates a v2 object), or the usage of <code>Renderable::getRenderOperation</code> and <code>v1::RenderOperation</code>, which indicates a v1 object.</p>
<p>See <a class="el" href="class_ogre_1_1_render_queue.html" title="Class to manage the scene object rendering queue.">Ogre::RenderQueue</a> remarks for the default render queue IDs.</p>
<p>You can change the render queue modes with the following snippet:</p>
<div class="fragment"><div class="line">mSceneManager-&gt;getRenderQueue()-&gt;setRenderQueueMode(5,<a class="code hl_enumvalue" href="class_ogre_1_1_render_queue.html#ad2b57c9b40e33d4b64f613a5a6147367aae5865e2c1ce44806f2538863c9dda44">Ogre::RenderQueue::Modes::V1_FAST</a>);</div>
<div class="line">Entity*entity;</div>
<div class="line">entity-&gt;setRenderQueueGroup(5);  </div>
<div class="ttc" id="aclass_ogre_1_1_render_queue_html_ad2b57c9b40e33d4b64f613a5a6147367aae5865e2c1ce44806f2538863c9dda44"><div class="ttname"><a href="class_ogre_1_1_render_queue.html#ad2b57c9b40e33d4b64f613a5a6147367aae5865e2c1ce44806f2538863c9dda44">Ogre::RenderQueue::V1_FAST</a></div><div class="ttdeci">@ V1_FAST</div><div class="ttdoc">Renders v1 entities using HLMS materials with some of the new benefits, but some deprecated features ...</div><div class="ttdef"><b>Definition</b> OgreRenderQueue.h:197</div></div>
</div><!-- fragment --><p>In this example, it sets the queue ID 5 to <code>V1_FAST</code>, and later adds the entity to that queue. The RenderQueue mode can be changed later (however you will have to move the Entity out of the queue ID into another valid one by yourself, otherwise <a class="el" href="namespace_ogre.html" title="bswapNN may be defined as macros in &lt;sys/endian.h&gt; or &lt;sys/bswap.h&gt;">Ogre</a> may crash)</p>
<h1><a class="anchor" id="VaoMaanger"></a>
The VaoManager</h1>
<p>It got its name as it was originally developed to handle just <code>VertexArrayObjects</code>; which is a concept borrowed from OpenGL: a vao is an object that stores the vertex attribute definitions and its vertex and index buffer bindings.</p>
<p>However the VaoManager quickly evolved into a central low level memory management for GPU memory. The name just stuck on since. The <code>VaoManager</code> works by requesting a pool of GPU memory to the API by a fixed length, and will not request more GPU memory until the manager ran out of it.</p>
<p>This manager is responsible to create the Vertex, Index, Constant, Texture and Index Buffers, and does so by reserving a space from the same pool of memory available (when allowed by the API[^14])</p>
<p>This system is written under the assumption that the API performs no hazard tracking at all, thus making it an excellent choice for OpenGL 3/4+, DX12, and Mantle.</p>
<p>Dynamic buffers will allocate 3x more memory than requested to handle a triple buffer scheme and avoid stalls. Fences[^15] are frame-wide to reduce driver overhead. A user is expected to fill all the data again from a dynamic buffer; as it is not suitable for performing only partial updates.</p>
<p>To perform partial updates, use DEFAULT buffers, and update them via staging buffers (see Hlms PBS implementation)</p>
<p>[^13]: For more information, see <em>Order your graphics draw calls around!</em> (<a href="http://realtimecollisiondetection.net/blog/?p=86">http://realtimecollisiondetection.net/blog/?p=86</a>) and <em>Rough sorting by Depth</em> (<a href="http://aras-p.info/blog/2014/01/16/rough-sorting-by-depth/">http://aras-p.info/blog/2014/01/16/rough-sorting-by-depth/</a>) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="manual.html">Manual</a></li><li class="navelem"><a class="el" href="_introduction_and_changes.html">Introduction &amp; Changes from Ogre 1.x</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
